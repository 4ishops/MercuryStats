# Работа с электросчетчиком Меркурий 200.02 через RS485

#### Общее
Электросчетчик подключен через usb-485 переходник к роутеру wl500g.
На роутере скрипт по крону получает данные и отправляет их на xively для рисования графиков

#### Раскладываем протокол
Для работы необходимо знать адрес счетчика. Для 200.02 это последние 6 цифр серийного номера
В моем случае это 411486 (в десятичном представлении)

06 47 5E - адрес счетчика в HEX

формат пакета запроса:
1 байт 	 - Заголовое пакета
2-4 байт - Адрес устройства
5 байт   - команда
6,7 байт - CRC16 Modbus

формат пакета ответа:
1 байт 	 - Заголовое пакета
2-4 байт - Адрес устройства
5 байт   - команда на которую отвечает
байты ответа в виде десятичного числа
последние два байта - CRC16 Modbus

##### Команды

# мгновенные значения
00 06 47 5E 63 EC D4 

# прочитать время
 00 06 47 5E 21 6C E5    - дата время текущее
 00 06 47 5E 24 AC E6 
 00 06 47 5E 25 6D 26

# Энергия
00 06 47 5E 27 EC E7   
ответ: 3 байта тариф1, 3 байта тариф2,3 байта тариф3, 3 байта тариф4                         

# служебная информация
 00 06 47 5E 2F ED 21                                                       
 00 06 47 5E 65 6C D6                             
 00 06 47 5E 2C AD 20                              
 00 06 47 5E 2B EC E2                              
 00 06 47 5E 87 EC 9F                              
 00 06 47 5E 87 EC 9F                      

# напряжение батареи
 00 06 47 5E 29 6D 23  
ответ: байт вольт, байт десятой части

# дата изготовления
 00 06 47 5E 66 2C D7 
ответ: байт адреса, байт месяца, байт года
 
# индикация на дисплее
00 06 47 5E 2A 2D 22
00 06 47 5E 67 ED 17                             

#версия
00 06 47 5E 28 AC E3                    
ответ: байт версии, байт подверсии

# тарифное расписание
00 06 47 5E 31 00 E8 ED                           

# лимит энергии
00 06 47 5E 23 ED 24                               
9999 квт*ч

# лимит мощности
00 06 47 5E 22 2C E4                         
99990 Вт

# чтение мощности
00 06 47 5E 26 2D 27                              

# функция испульсного выхода чтение
00 06 47 5E 2D 6C E0                              

# коррекция времени кнопками
00 06 47 5E 25 6D 26                             

# флаг перехода зимнее.летнее
00 06 47 5E 24 AC E6